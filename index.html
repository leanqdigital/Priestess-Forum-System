<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priestess Forum System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.87/dist/themes/light.css">
    <link href="https://unpkg.com/devextreme@19.1-next/dist/css/dx.common.css" rel="stylesheet">
    <link href="https://unpkg.com/devextreme@19.1-next/dist/css/dx.light.css" rel="stylesheet">
</head>

<body class="bg-gray-50">

    <!-- Post Modal -->
    <sl-dialog id="post-modal" label="Post Details">
        <div id="post-modal-content" class="space-y-4"></div>
    </sl-dialog>

    <!-- Add this after the post-modal -->
    <sl-dialog id="delete-modal" label="Confirm Deletion">
        <div class="space-y-4">
            <p>Are you sure you want to delete this post? This action cannot be undone.</p>
            <div class="flex justify-end gap-4 mt-4">
                <sl-button variant="default" class="cancel-delete">Cancel</sl-button>
                <sl-button variant="danger" class="confirm-delete">Delete</sl-button>
            </div>
        </div>
    </sl-dialog>

    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- Controls Section -->
        <section class="mb-8 text-center flex flex-col gap-4">
            <div class="mb-6">
                <sl-button variant="default" class="refresh-button">
                    <sl-icon name="arrow-clockwise" slot="prefix"></sl-icon>
                    Refresh
                </sl-button>
            </div>

            <div class="flex flex-wrap gap-4 justify-center">
                <sl-button variant="default" class="filter-button" data-filter="recent">Recent Posts</sl-button>
                <sl-button variant="default" class="filter-button" data-filter="featured">Featured Posts</sl-button>
                <sl-button variant="default" class="filter-button" data-filter="my">My Posts</sl-button>
                <sl-button variant="default" class="filter-button" data-filter="saved">Saved Posts</sl-button>
            </div>

            <!-- Post Creation Form -->
            <section class="mb-6 p-4 bg-white shadow-sm rounded-lg">
                <h2 class="text-lg font-semibold mb-2">Create a Post</h2>
                <div class="dx-viewport demo-container w-full">
                    <div id="html-objects"></div>
                </div>
                <sl-button id="submit-post" variant="primary" class="mt-4">Post</sl-button>
            </section>
        </section>

        <!-- Posts Container -->
        <main id="posts-container" class="space-y-6"></main>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="text-center hidden py-4">
            <sl-spinner class="loading-spinner text-2xl"></sl-spinner>
        </div>

        <!-- Error Display -->
        <div id="error-display" class="hidden p-4 bg-red-100 text-red-700 rounded-lg"></div>

        <!-- Load More Button -->
        <div class="text-center mt-6">
            <sl-button variant="primary" id="load-more-button" class="hidden">
                Load More
            </sl-button>
        </div>
    </div>

    <!-- Templates -->
    <script type="text/html" id="post-template">
        <article class="post bg-white rounded-lg shadow-sm p-6" data-post-id="{{:id}}">
          <header class="flex items-center gap-4 mb-4">
            <img class="w-10 h-10 rounded-full object-cover" 
                 src="{{:author.profileImage}}" 
                 alt="{{:author.name}}"
                 onerror="this.src='{{:defaultAuthorImage}}'">
            <div class = "flex items-center justify-between w-full">
                <div>
                    <h2 class="font-semibold text-gray-800">{{:author.name}}</h2>
                    <time class="text-sm text-gray-500">{{:date}}</time>
                </div>
                {{if author_id == "171031"}}
                <div class="flex items-center gap-4">
                  <button type="button" 
                          class="delete-post-btn text-red-600 hover:text-red-800"
                          data-post-id="{{:id}}">
                    Delete
                  </button>
                  <button type="button" 
                          class="edit-post-btn text-blue-600 hover:text-blue-800"
                          data-post-id="{{:id}}">
                    Edit
                  </button>
                </div>
                {{/if}}
            </div>
          </header>
          
          <div class="post-content mb-4">
            <div class="text-gray-700 whitespace-pre-wrap">{{:content}}</div>
          </div>
      
          <footer class="comments-section">
            <div class="mt-4 text-center">
              <sl-button variant="default" size="small" 
                        class="load-comments-btn"
                        data-post-id="{{:id}}">
                Show Comments
              </sl-button>
              <sl-button variant="default" size="small" 
                        class="save-post-btn"
                        data-post-id="{{:id}}">
                Save This Post
              </sl-button>
            </div>
          </footer>
        </article>
      </script>


    <script type="text/html" id="comment-template">
        <div class="comment bg-gray-50 rounded p-4 mt-4">
            <div class="flex items-center gap-3 mb-2">
                <img class="w-8 h-8 rounded-full object-cover"
                     src="{{:author.profileImage}}"
                     alt="{{:author.name}}"
                     onerror="this.src='{{:defaultAuthorImage}}'">
                <div>
                    <h4 class="text-sm font-medium text-gray-700">{{:author.name}}</h4>
                    <time class="text-xs text-gray-500">{{:date}}</time>
                </div>
            </div>
            <p class="text-gray-600 text-sm">{{:content}}</p>
        </div>
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/1.0.5/jsrender.min.js"></script>
    <script type="module"
        src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.87/dist/shoelace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.min.js"></script>
    <script src="https://unpkg.com/devextreme@19.1-next/dist/js/dx.all.js"></script>


    <!-- Your App Scripts -->
    <script src="script/config.js"></script>
    <script src="script/api_service.js"></script>
    <script src="script/formatter.js"></script>
    <script src="script/ui_manager.js"></script>
    <script src="script/app.js"></script>
</body>

</html>